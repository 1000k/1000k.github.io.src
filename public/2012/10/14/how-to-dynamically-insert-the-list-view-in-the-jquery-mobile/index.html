<!DOCTYPE html>
<html>

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<title> jQuery Mobileでリストビューを動的に挿入する方法 &middot; 1000g </title>


<link rel="stylesheet" href="http://1000k.github.io//css/slim.css">
<link rel="stylesheet" href="http://1000k.github.io//css/highlight.min.css">
<link href='http://fonts.googleapis.com/css?family=Open+Sans:300,400,600&subset=latin,latin-ext' rel='stylesheet'>

<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
<link rel="shortcut icon" href="/favicon.ico">


<link href="" rel="alternate" type="application/rss+xml" title="1000g" />

</head>

<body>
  <div class="container">
    <div class="header">
  <h1 class="site-title"><a href="http://1000k.github.io/">1000g</a></h1>
  <p class="site-tagline">Tech blog</p>
  <div class="nav">
    <a class="nav-btn" href="#">
      <span class="ci ci-burger"></span>
    </a>
    <ul class="nav-list">
       
	  <li class="spacer">&ac;</li>

      <li><a href="https://github.com/1000k">Github</a></li> 
      <li><a href="https://twitter.com/1000kei">Twitter</a></li> 
    </ul>
  </div>
</div>
    <div class="content">
      <div class="post">
        <h2 class="post-title"><a href="http://1000k.github.io/2012/10/14/how-to-dynamically-insert-the-list-view-in-the-jquery-mobile/">jQuery Mobileでリストビューを動的に挿入する方法</a></h2>
        <div class="post-content">
          

<p>jQuery Mobile 1.2 を使ってリストビューを動的に挿入する手順を紹介します。</p>

<p><a href="http://jquerymobile.com/test/docs/pages/page-dynamic.html" onclick="_gaq.push(['_trackEvent', 'outbound-article', 'http://jquerymobile.com/test/docs/pages/page-dynamic.html', '公式マニュアル']);" title="jQuery Mobile Docs - Dynamically Injecting Pages">公式マニュアル</a>にもやり方は書いてあるのですが、本題と関係ない部分（リンクをクリックしたらその取得先を正規表現で取得するなど）が長く読みづらいので、もっと簡単なバージョンを書きました。</p>

<h2 id="やりたいこと:83f3cc2b588221556f2cadc603a0bf3c">やりたいこと</h2>

<ol>
<li>「Inject!」ボタンを押す</li>
<li>「data-role=&#8221;content&#8221;」内にリストビューを挿入する</li>
<li>画面遷移せずに表示する</li>
</ol>

<p>画面イメージはこんな感じです。↓</p>

<p><img src="http://blog.1000k.net/wp-content/uploads/dynamic_injection1.png" alt="" title="before" width="444" height="296" class="alignnone size-full wp-image-1173" /></p>

<p>「Inject!」をクリックすると、ヘッダとコンテンツが書き換えられます。</p>

<p><img src="http://blog.1000k.net/wp-content/uploads/dynamic_injection2.png" alt="" title="after" width="444" height="248" class="alignnone size-full wp-image-1174" /></p>

<h2 id="サンプルコード:83f3cc2b588221556f2cadc603a0bf3c">サンプルコード</h2>

<pre><code>






&lt;div data-role=&quot;page&quot; id=&quot;page1&quot;&gt;
  &lt;div data-role=&quot;header&quot;&gt;
    &lt;h1&gt;
      Dynamic Injection
    &lt;/h1&gt;

  &lt;/div&gt;



  &lt;div data-role=&quot;content&quot;&gt;
    &lt;a href=&quot;#&quot; data-role=&quot;button&quot; id=&quot;inject&quot;&gt;Inject!&lt;/a&gt;

  &lt;/div&gt;

&lt;/div&gt;


</code></pre>

<p>処理の内容を細かく見てみましょう。</p>

<h3 id="クリックイベントをバインドする:83f3cc2b588221556f2cadc603a0bf3c">クリックイベントをバインドする</h3>

<p>はじめに、「Inject!」ボタンをクリックした時に showList() 関数を呼び出すようにバインドします。</p>

<pre><code>$(&quot;#inject&quot;).live(&quot;click&quot;, function() {
  showList();
});
</code></pre>

<p>次に showList() の中身を見てみます。</p>

<h3 id="dom要素を格納する:83f3cc2b588221556f2cadc603a0bf3c">DOM要素を格納する</h3>

<p>まずはページ内の各要素のDOM要素を変数に格納しておきます。</p>

<pre><code>var $page = $(&quot;#page1&quot;),
      $header = $page.children(&quot;:jqmData(role=header)&quot;),
      $content = $page.children(&quot;:jqmData(role=content)&quot;);
</code></pre>

<p>ちなみにこの「:jqmData()」はjQuery Mobile 用のカスタムセレクタです。</p>

<p>意味は「$page.childern(&#8220;[data-role=header]&#8221;)」と同じなのですが、jQM独自の「data-*」という要素をセレクトしたい場合はこちらを使う方が良いそうです。</p>

<p>詳しくは下記のマニュアルを参照してください。</p>

<p><a href="http://dev.screw-axis.com/doc/jquery_mobile/api/methods_utilities/methods/jqmData/" onclick="_gaq.push(['_trackEvent', 'outbound-article', 'http://dev.screw-axis.com/doc/jquery_mobile/api/methods_utilities/methods/jqmData/', 'jqmData | jQuery Mobile 1.1.0 日本語リファレンス']);" >jqmData | jQuery Mobile 1.1.0 日本語リファレンス</a></p>

<h3 id="リストビューを生成する:83f3cc2b588221556f2cadc603a0bf3c">リストビューを生成する</h3>

<p>続いてリストビューのDOM要素を生成します。</p>

<p>jQueryのメソッドチェーンを使って作成すると楽です。</p>

<pre><code>var $listview = $(&quot;

&lt;ul&gt;
  &quot;).attr({&quot;data-role&quot;:&quot;listview&quot;, &quot;data-inset&quot;:&quot;true&quot;})
      .append(
        $(&quot;

  &lt;li&gt;
    &quot;).attr({&quot;data-wrapperrels&quot;:&quot;div&quot;, &quot;data-iconpos&quot;:&quot;right&quot;, &quot;data-icon&quot;:&quot;arrow-l&quot;})
            .append($(&quot;&lt;a&gt;&quot;).attr({&quot;href&quot;:&quot;#&quot;, &quot;title&quot;:&quot;Home&quot;, &quot;data-rel&quot;:&quot;back&quot;})
              .append($(&quot;

    &lt;h3&gt;
      &quot;).text(&quot;FOO&quot;))
                .append($(&quot;&quot;).attr({&quot;class&quot;:&quot;ui-li-aside ui-li-desc&quot;}).text(&quot;BAR&quot;))
              )
          ).appendTo(&quot;:jqmData(role=content)&quot;);
      ```



      &lt;p&gt;
        見慣れないと読みにくいかもしれませんが、インデントで階層構造が表現できて楽です。&lt;br /&gt;
        これで実際に作成されるHTMLは以下のようになります。
      &lt;/p&gt;


      ```



&lt;ul data-role=&quot;listview&quot; data-inset=&quot;true&quot;&gt;
  &lt;li data-icon=&quot;arrow-r&quot; data-iconpos=&quot;right&quot; data-wrapperrels=&quot;div&quot;&gt;
    &lt;a href=&quot;#&quot;&gt;


    &lt;h3&gt;
      FOO
    &lt;/h3&gt;


    &lt;p class=&quot;ui-li-aside ui-li-desc&quot;&gt;
      BAR
              &lt;/a&gt;
          &lt;/li&gt;
      &lt;/ul&gt;
      ```



      &lt;p&gt;
        なお、この形式のリストは公式ドキュメントでは「Formatted content」と呼ばれています。説明ページは下記。
      &lt;/p&gt;


      &lt;p&gt;
        &lt;a href=&quot;http://jquerymobile.com/test/docs/lists/lists-inset.html&quot; onclick=&quot;_gaq.push(['_trackEvent', 'outbound-article', 'http://jquerymobile.com/test/docs/lists/lists-inset.html', 'jQuery Mobile Docs &amp;#8211; Lists with Form Controls']);&quot; &gt;jQuery Mobile Docs &amp;#8211; Lists with Form Controls&lt;/a&gt;
      &lt;/p&gt;


      &lt;h3&gt;
        DOM要素を変更＆挿入する
      &lt;/h3&gt;


      &lt;p&gt;
        ページの要素を書き換えます。
      &lt;/p&gt;


      ```

  $header.find(&quot;h1&quot;).html(&quot;Injected&quot;);
  $content.html($listview);

  $page.page();
  $content.find(&quot;:jqmData(role=listview)&quot;).listview();
</code></pre>

<pre><code>  &lt;p&gt;
    「$page.page()」は、遅延してページ要素を編集した後には必ず呼び出さねばならないようです。&lt;br /&gt;
    その後、「$content.find(&amp;#8220;:jqmData(role=listview)&amp;#8221;).listview();」でリストビューをスタイリングしています。
  &lt;/p&gt;


  &lt;h3&gt;
    ページを表示する
  &lt;/h3&gt;


  &lt;p&gt;
    最後にページ遷移を手動で発生させます。&lt;br /&gt;
    これまでに編集したDOM要素が表示されます。
  &lt;/p&gt;


  ```
</code></pre>

<p>$.mobile.changePage($page);
```</p>

<pre><code>  &lt;h2&gt;
    補足
  &lt;/h2&gt;


  &lt;p&gt;
    &lt;a href=&quot;http://jquerymobile.com/test/docs/pages/page-dynamic.html&quot; onclick=&quot;_gaq.push(['_trackEvent', 'outbound-article', 'http://jquerymobile.com/test/docs/pages/page-dynamic.html', '公式ドキュメントのチュートリアル']);&quot; title=&quot;jQuery Mobile Docs - Dynamically Injecting Pages&quot;&gt;公式ドキュメントのチュートリアル&lt;/a&gt;ではここで紹介した内容にプラスして、「クリックしたボタンのhref属性を解析してデータ取得先を分ける」手順が説明されています。むしろその部分が長すぎて理解しづらくなっている気がします。
  &lt;/p&gt;


  &lt;h2&gt;
    参考
  &lt;/h2&gt;


  &lt;ul&gt;
    &lt;li&gt;
      &lt;a href=&quot;http://jquerymobile.com/test/docs/pages/page-dynamic.html&quot; onclick=&quot;_gaq.push(['_trackEvent', 'outbound-article', 'http://jquerymobile.com/test/docs/pages/page-dynamic.html', 'jQuery Mobile Docs &amp;#8211; Dynamically Injecting Pages']);&quot; &gt;jQuery Mobile Docs &amp;#8211; Dynamically Injecting Pages&lt;/a&gt;
      &lt;ul&gt;
        &lt;li&gt;
          公式のチュートリアル。長い。
        &lt;/li&gt;

      &lt;/ul&gt;

    &lt;/li&gt;


    &lt;li&gt;
      &lt;a href=&quot;http://jquerymobile.com/test/docs/api/methods.html&quot; onclick=&quot;_gaq.push(['_trackEvent', 'outbound-article', 'http://jquerymobile.com/test/docs/api/methods.html', 'jQuery Mobile Docs &amp;#8211; Methods']);&quot; &gt;jQuery Mobile Docs &amp;#8211; Methods&lt;/a&gt;
      &lt;ul&gt;
        &lt;li&gt;
          $.mobile.changePage() のリファレンス。
        &lt;/li&gt;

      &lt;/ul&gt;

    &lt;/li&gt;


    &lt;li&gt;
      &lt;a href=&quot;http://dev.screw-axis.com/doc/jquery_mobile/api/methods_utilities/methods/jqmData/&quot; onclick=&quot;_gaq.push(['_trackEvent', 'outbound-article', 'http://dev.screw-axis.com/doc/jquery_mobile/api/methods_utilities/methods/jqmData/', 'jqmData | jQuery Mobile 1.1.0 日本語リファレンス']);&quot; &gt;jqmData | jQuery Mobile 1.1.0 日本語リファレンス&lt;/a&gt;
      &lt;ul&gt;
        &lt;li&gt;
          カスタムセレクタ「jqmData」の説明。
        &lt;/li&gt;

      &lt;/ul&gt;

    &lt;/li&gt;


    &lt;li&gt;
      &lt;a href=&quot;http://dev.screw-axis.com/doc/jquery_mobile/components/lists/docs/&quot; onclick=&quot;_gaq.push(['_trackEvent', 'outbound-article', 'http://dev.screw-axis.com/doc/jquery_mobile/components/lists/docs/', 'リストビューについて | jQuery Mobile 1.1.0 日本語リファレンス']);&quot; &gt;リストビューについて | jQuery Mobile 1.1.0 日本語リファレンス&lt;/a&gt;
    &lt;/li&gt;


    &lt;li&gt;
      &lt;a href=&quot;http://www.packtpub.com/article/jquery-mobile-organizing-information-with-list-views&quot; onclick=&quot;_gaq.push(['_trackEvent', 'outbound-article', 'http://www.packtpub.com/article/jquery-mobile-organizing-information-with-list-views', 'jQuery Mobile: Organizing Information with List Views | Packt Publishing']);&quot; &gt;jQuery Mobile: Organizing Information with List Views | Packt Publishing&lt;/a&gt;
      &lt;ul&gt;
        &lt;li&gt;
          公式ドキュメントのリストビューの解説ではコードが書いてありませんが、このページには書いています。
        &lt;/li&gt;

      &lt;/ul&gt;

    &lt;/li&gt;


    &lt;li&gt;
      &lt;a href=&quot;http://stackoverflow.com/questions/805159/building-html-dom-using-jquery&quot; onclick=&quot;_gaq.push(['_trackEvent', 'outbound-article', 'http://stackoverflow.com/questions/805159/building-html-dom-using-jquery', 'Building HTML (~= DOM) using jQuery &amp;#8211; Stack Overflow']);&quot; &gt;Building HTML (~= DOM) using jQuery &amp;#8211; Stack Overflow&lt;/a&gt;
      &lt;ul&gt;
        &lt;li&gt;
          jQueryのメソッドチェーンを使ってDOMを組み立てる方法。
        &lt;/li&gt;

      &lt;/ul&gt;

    &lt;/li&gt;

  &lt;/ul&gt;
</code></pre>

        </div>
      </div>
    </div>
    <div class="footer">
  <p>Powered by <a href="http://gohugo.io">Hugo</a>. This theme—Slim—is open sourced on <a href="https://github.com/zhe/hugo-theme-slim">Github</a>.</p>
</div>

  </div>
  <script src="http://1000k.github.io//js/slim.js"></script>
  <script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-46659459-2', 'auto');
ga('send', 'pageview');

</script>


</body>

</html>